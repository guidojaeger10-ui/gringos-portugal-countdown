<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gringos âœˆï¸ Berlin â†’ Faro</title>

  <style>
    :root{
      --glass: rgba(255,255,255,0.16);
      --glass2: rgba(255,255,255,0.24);
      --stroke: rgba(255,255,255,0.26);
      --shadow: 0 18px 55px rgba(0,0,0,0.16);
      --text: #0b2239;
      --muted: rgba(11,34,57,0.68);
      --accent: rgba(255,255,255,0.88);
    }

    *{ box-sizing:border-box }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      text-align:center;
      min-height:100vh;
      overflow-x:hidden;
      background:
        radial-gradient(1100px 750px at 15% 18%, rgba(255,255,255,0.80), rgba(255,255,255,0) 60%),
        radial-gradient(900px 700px at 85% 20%, rgba(80,180,255,0.38), rgba(255,255,255,0) 62%),
        radial-gradient(1000px 800px at 55% 90%, rgba(0,220,170,0.14), rgba(255,255,255,0) 62%),
        linear-gradient(180deg, #7ad7ff 0%, #c7f3ff 48%, #ffffff 100%);
    }

    /* Ambient bokeh */
    body::before, body::after{
      content:"";
      position: fixed;
      inset: -25vmax;
      z-index:-2;
      filter: blur(44px);
      opacity: .55;
      background:
        radial-gradient(circle at 20% 18%, rgba(255,255,255,0.95), transparent 38%),
        radial-gradient(circle at 40% 70%, rgba(0,180,255,0.55), transparent 45%),
        radial-gradient(circle at 76% 34%, rgba(255,170,90,0.45), transparent 42%),
        radial-gradient(circle at 78% 82%, rgba(0,220,170,0.30), transparent 50%);
      animation: floaty 18s ease-in-out infinite;
      transform: translate3d(0,0,0);
    }
    body::after{ opacity:.32; animation-duration: 28s; animation-direction: reverse; }
    @keyframes floaty{ 0%{ transform: translate(0,0) scale(1);} 50%{ transform: translate(2.2vmax,-1.7vmax) scale(1.04);} 100%{ transform: translate(0,0) scale(1);} }

    :root.night{
      color-scheme: dark;
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --glass: rgba(255,255,255,0.10);
      --glass2: rgba(255,255,255,0.16);
      --stroke: rgba(255,255,255,0.18);
    }
    :root.night body{
      background:
        radial-gradient(1200px 800px at 12% 18%, rgba(14,30,48,0.88), rgba(0,0,0,0) 58%),
        radial-gradient(900px 700px at 88% 20%, rgba(40,120,255,0.22), rgba(0,0,0,0) 62%),
        radial-gradient(1100px 800px at 60% 90%, rgba(0,220,170,0.10), rgba(0,0,0,0) 62%),
        linear-gradient(180deg, #0b1a2a 0%, #0e2a3f 55%, #0a111a 100%);
    }

    :root.sunset{
      color-scheme: light;
      --text: #2a1a12;
      --muted: rgba(42,26,18,0.72);
    }
    :root.sunset body{
      background:
        radial-gradient(1100px 800px at 15% 18%, rgba(255,255,255,0.78), rgba(255,255,255,0) 60%),
        radial-gradient(900px 700px at 85% 22%, rgba(255,170,90,0.36), rgba(255,255,255,0) 62%),
        radial-gradient(1100px 800px at 55% 92%, rgba(255,90,140,0.14), rgba(255,255,255,0) 62%),
        linear-gradient(180deg, #ffb36a 0%, #ffd3b6 35%, #c7f3ff 78%, #fff 100%);
    }

    .hero{ padding: 2.6rem 1rem 1.1rem; }
    .hero-inner{ max-width: 1040px; margin: 0 auto; }

    .kicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: .4rem .85rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(255,255,255,0.35);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.10);
      font-weight: 900;
      letter-spacing: .05em;
      text-transform: uppercase;
      font-size: .72rem;
      color: var(--muted);
    }

    h1{
      font-size: clamp(2.05rem, 3.2vw, 2.9rem);
      margin: .7rem 0 .5rem;
      letter-spacing: -0.02em;
      text-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    .sub{ margin:0; color: var(--muted); font-weight: 650; }

    .countdown{
      display:flex; justify-content:center; gap: 1rem; flex-wrap: wrap;
      margin: 1.7rem 0 1.2rem;
      padding: 0 1rem;
    }

    .time-box{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      padding: 1rem 1.6rem;
      min-width: 112px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      transition: transform .18s ease, background .18s ease;
      position: relative;
      overflow: hidden;
    }
    .time-box::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, rgba(255,255,255,0.55), rgba(255,255,255,0) 40%, rgba(255,255,255,0.35));
      opacity: .55;
      transform: translateX(-40%);
    }
    .time-box:hover{ transform: translateY(-4px) scale(1.01); background: var(--glass2); }

    .time-box span{ display:block; font-size: 2.2rem; font-weight: 950; }
    .time-box label{ display:block; font-size: .75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); }

    .hero-actions{ display:flex; justify-content:center; gap: .75rem; flex-wrap: wrap; margin-top: .9rem; }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      padding: 12px 16px;
      border-radius: 999px;
      font-weight: 900;
      color: var(--text);
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(255,255,255,0.42);
      box-shadow: 0 16px 35px rgba(0,0,0,0.14);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition: transform .15s ease, filter .15s ease;
    }
    .btn:hover{ transform: translateY(-2px); filter: brightness(1.02); }
    .btn:active{ transform: translateY(0); }
    .btn-ghost{ background: rgba(255,255,255,0.55); }

    .scroll-hint{ margin-top: 1.2rem; color: var(--muted); font-weight: 750; font-size: .95rem; }

    .section{ padding: 1.2rem 1rem 1.85rem; }
    .section-title{ margin: .3rem 0 1rem; font-size: 1.68rem; text-shadow: 0 10px 25px rgba(0,0,0,0.10); }

    .gallery{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      padding: 1rem 2rem 1.7rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .gallery img{
      width:100%; height: 220px; object-fit: cover;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 18px 45px rgba(0,0,0,0.16);
      transform: translateY(10px);
      opacity: 0;
      animation: popIn .7s ease forwards;
    }
    .gallery img:nth-child(1){ animation-delay: .05s; }
    .gallery img:nth-child(2){ animation-delay: .12s; }
    .gallery img:nth-child(3){ animation-delay: .19s; }
    .gallery img:nth-child(4){ animation-delay: .26s; }
    .gallery img:nth-child(5){ animation-delay: .33s; }
    .gallery img:hover{ transform: translateY(-4px) scale(1.02); transition: transform .18s ease; }
    @keyframes popIn{ to{ opacity: 1; transform: translateY(0);} }

    /* Lightbox */
    .lightbox{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.62); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); z-index: 120; padding: 18px; }
    .lightbox.open{ display:flex; }
    .lightbox img{ max-width: min(1150px, 96vw); max-height: 86vh; border-radius: 18px; box-shadow: 0 25px 70px rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.18); }
    .lb-close{ position: fixed; top: 16px; right: 16px; width: 46px; height: 46px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.25); background: rgba(255,255,255,0.18); color: #fff; font-size: 18px; cursor:pointer; box-shadow: 0 18px 45px rgba(0,0,0,0.25); }

    /* Timeline */
    .timeline{ max-width: 980px; margin: 0 auto; background: var(--glass); border:1px solid rgba(255,255,255,0.30); border-radius: 22px; box-shadow: var(--shadow); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); padding: 1rem 1rem; text-align:left; }
    .step{ display:flex; gap: 14px; padding: 14px 10px; border-radius: 16px; }
    .step:hover{ background: rgba(255,255,255,0.14); }
    .dot{ width: 12px; height: 12px; margin-top: 6px; border-radius: 999px; background: rgba(11,34,57,0.55); box-shadow: 0 0 0 6px rgba(255,255,255,0.22); }
    :root.night .dot{ background: rgba(255,255,255,0.60); }
    .step-title{ font-weight: 950; }
    .step-sub{ color: var(--muted); margin-top: 2px; }

    /* Map */
    .map-card{ max-width: 980px; margin: 0 auto; padding: 14px; border-radius: 22px; background: var(--glass); border:1px solid rgba(255,255,255,0.30); box-shadow: var(--shadow); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); text-align:left; }
    .map-top{ display:flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; margin: 4px 2px 10px; }
    .map-pill{ padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.22); color: var(--muted); font-weight: 900; }
    .map-wrap{ position: relative; border-radius: 18px; overflow:hidden; border:1px solid rgba(255,255,255,0.22); box-shadow: 0 18px 45px rgba(0,0,0,0.14); }
    #mapCanvas{ width: 100%; height: auto; display:block; background: transparent; }

    .hud{
      position:absolute;
      left: 14px;
      bottom: 14px;
      right: 14px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
      pointer-events:none;
    }

    .hud .chip{
      pointer-events:none;
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.28);
      color: rgba(255,255,255,0.92);
      border: 1px solid rgba(255,255,255,0.16);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      font-weight: 850;
    }

    .progress{
      pointer-events:none;
      flex: 1;
      min-width: 210px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      border: 1px solid rgba(255,255,255,0.18);
      overflow:hidden;
    }
    .progress > div{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: rgba(255,255,255,0.75);
    }

    .map-sub{ margin: 10px 2px 0; color: var(--muted); font-weight: 750; }

    /* Toast */
    .toast{ position: fixed; top: 14px; left: 50%; transform: translateX(-50%); z-index: 140; padding: 10px 14px; border-radius: 999px; background: rgba(0,0,0,0.35); color: rgba(255,255,255,0.92); border: 1px solid rgba(255,255,255,0.18); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); box-shadow: 0 18px 45px rgba(0,0,0,0.22); opacity: 0; pointer-events: none; }
    .toast.show{ opacity: 1; }

    /* Overlay */
    .overlay{ position: fixed; inset:0; background: rgba(0,0,0,0.55); display:flex; align-items:center; justify-content:center; z-index: 150; padding: 18px; }
    .overlay[hidden]{ display:none !important; }
    .overlay-card{ width: min(560px, 92vw); border-radius: 22px; background: rgba(255,255,255,0.16); border: 1px solid rgba(255,255,255,0.26); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); box-shadow: 0 30px 90px rgba(0,0,0,0.35); padding: 18px 18px 16px; color:#fff; text-align:center; }
    .overlay-title{ font-size: 2rem; font-weight: 950; letter-spacing: .04em; }
    .overlay-sub{ opacity: .9; margin: .5rem 0 1rem; }

    /* Waves */
    .waves{ position: fixed; left:0; right:0; bottom:0; height: 150px; z-index: -1; opacity: .92; }
    .waves svg{ width: 100%; height: 100%; display:block; }
    .waves path{ fill: rgba(255,255,255,0.40); }
    :root.night .waves path{ fill: rgba(255,255,255,0.10); }
    :root.sunset .waves path{ fill: rgba(255,255,255,0.22); }
    #wave1{ opacity:.55; animation: waveMove 12s ease-in-out infinite; }
    #wave2{ opacity:.35; animation: waveMove 18s ease-in-out infinite reverse; }
    #wave3{ opacity:.22; animation: waveMove 24s ease-in-out infinite; }
    @keyframes waveMove{ 0%{ transform: translateX(0); } 50%{ transform: translateX(-22px); } 100%{ transform: translateX(0); } }

    /* Floating action button */
    .fab{
      position: fixed;
      right: 16px;
      bottom: 16px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,0.75);
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: 0 16px 35px rgba(0,0,0,0.18);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      cursor: pointer;
      user-select: none;
      font-weight: 900;
      color: #0b2239;
      transition: transform .15s ease;
      z-index: 160;
    }
    .fab:hover{ transform: translateY(-2px); }

    /* Confetti canvas */
    #confetti{ position: fixed; inset:0; pointer-events:none; z-index: 130; }

    footer{ font-size: .9rem; color: var(--muted); padding: 0 1rem 1.6rem; }

    @media (max-width: 520px){
      .gallery{ padding: 1rem; }
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="fab" id="themeBtn" style="left:16px; right:auto;">ğŸŒ¤ï¸ Theme</div>
  <div class="fab" id="soundBtn" style="left:16px; right:auto; bottom:64px;">ğŸ”‡ Sound</div>

  <header class="hero" id="hero">
    <div class="hero-inner">
      <div class="kicker">ğŸ–ï¸ ENDLEVEL Â· Berlin â†’ Faro</div>
      <h1 id="title">âœˆï¸ Countdown: Gringos nach Faro</h1>
      <p class="sub">Abflug am <strong>03.01.2026</strong> Â· Algarve vibes ğŸŒŠğŸ·</p>

      <section class="countdown" aria-label="Countdown">
        <div class="time-box"><span id="days">0</span><label>Tage</label></div>
        <div class="time-box"><span id="hours">0</span><label>Stunden</label></div>
        <div class="time-box"><span id="minutes">0</span><label>Minuten</label></div>
        <div class="time-box"><span id="seconds">0</span><label>Sekunden</label></div>
      </section>

      <div class="hero-actions">
        <button class="btn" id="simulateBtn">ğŸ›« Flug simulieren</button>
        <button class="btn btn-ghost" id="vibesBtn">â–¶ Start Vibes</button>
        <button class="btn btn-ghost" id="partyBtn">ğŸ‰ Party</button>
      </div>

      <div class="scroll-hint">Scroll fÃ¼r Villa, Plan & Flight HUD â†“</div>
    </div>
  </header>

  <section class="section">
    <h2 class="section-title">ğŸ¡ Villa Moments</h2>
    <div class="gallery" id="gallery">
      <img src="a.PNG" alt="Villa mit Pool" data-full="a.PNG" />
      <img src="aa.PNG" alt="Wohnzimmer" data-full="aa.PNG" />
      <img src="aaa.PNG" alt="Pool Area" data-full="aaa.PNG" />
      <img src="aaaa.PNG" alt="Schlafzimmer" data-full="aaaa.PNG" />
      <img src="gringos.PNG" alt="Die Gringos" data-full="gringos.PNG" />
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">ğŸ§­ Trip Timeline</h2>
    <div class="timeline">
      <div class="step"><div class="dot"></div><div><div class="step-title">âœˆï¸ Abflug</div><div class="step-sub">Berlin â†’ Faro Â· Boarding soon</div></div></div>
      <div class="step"><div class="dot"></div><div><div class="step-title">ğŸŒ… Ankunft & Sunset</div><div class="step-sub">Golden Hour in der Algarve</div></div></div>
      <div class="step"><div class="dot"></div><div><div class="step-title">ğŸ¡ Villa Check-in</div><div class="step-sub">Zimmer wÃ¤hlen, Terrasse claimen</div></div></div>
      <div class="step"><div class="dot"></div><div><div class="step-title">ğŸ» Erste Runde</div><div class="step-sub">Sagres kaltstellen</div></div></div>
      <div class="step"><div class="dot"></div><div><div class="step-title">ğŸŒŠ Beach Day</div><div class="step-sub">Wellen, Sonne, 0 Stress</div></div></div>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">ğŸ—ºï¸ Flight Path Â· Berlin â†’ Faro</h2>
    <div class="map-card">
      <div class="map-top">
        <div class="map-pill">From: <strong>Berlin</strong></div>
        <div class="map-pill">To: <strong>Faro</strong> ğŸ‡µğŸ‡¹</div>
        <div class="map-pill" id="flightInfo">Loadingâ€¦</div>
      </div>

      <div class="map-wrap">
        <canvas id="mapCanvas" width="1400" height="680"></canvas>

        <div class="hud" aria-hidden="true">
          <div class="chip" id="hudStatus">ğŸŸ¢ Ready</div>
          <div class="progress"><div id="hudBar"></div></div>
          <div class="chip" id="hudETA">ETA â€”</div>
        </div>
      </div>

      <div class="map-sub">Great-circle Route + Takeoff/Landing Simulation. (Autoplay blockt Sound â†’ klick auf ğŸ”Š)</div>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">ğŸ¶ Chillige Vibes</h2>
    <div class="music-card" id="musicCard" hidden>
      <iframe
        width="420"
        height="236"
        src="https://www.youtube.com/embed/WcIcVapfqXw?rel=0"
        title="YouTube music player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
      </iframe>
      <p class="sub" style="margin:0;">â–¶ï¸ Play drÃ¼cken & Portugal-Feeling starten ğŸ‡µğŸ‡¹</p>
    </div>
  </section>

  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lb-close" id="lbClose" aria-label="Close">âœ•</button>
    <img id="lbImg" alt="" />
  </div>

  <div class="overlay" id="overlay" hidden>
    <div class="overlay-card">
      <div class="overlay-title">âœˆï¸ BOARDING NOW</div>
      <div class="overlay-sub">Faro wartet. Gringos, letâ€™s go ğŸ‡µğŸ‡¹</div>
      <button class="btn" id="overlayParty">ğŸ‰ Konfetti</button>
    </div>
  </div>

  <div class="waves" aria-hidden="true">
    <svg viewBox="0 0 1200 120" preserveAspectRatio="none">
      <path id="wave1" d="M0,64 C150,120 350,0 600,64 C850,128 1050,16 1200,64 L1200,120 L0,120 Z"></path>
      <path id="wave2" d="M0,74 C200,124 350,10 600,74 C850,140 1000,24 1200,74 L1200,120 L0,120 Z"></path>
      <path id="wave3" d="M0,84 C220,120 380,26 600,84 C820,140 980,36 1200,84 L1200,120 L0,120 Z"></path>
    </svg>
  </div>

  <footer>
    Mit â¤ï¸ fÃ¼r die Gringos Â· Share den Link mit der Crew
  </footer>

  <script>
    // ============ Helpers ============
    const clamp = (x, a, b) => Math.max(a, Math.min(b, x));

    // Toast
    const toastEl = document.getElementById('toast');
    let toastT;
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      clearTimeout(toastT);
      toastT = setTimeout(()=> toastEl.classList.remove('show'), 2200);
    }

    // ============ Countdown ============
    const targetDate = new Date('2026-01-03T00:00:00').getTime();
    let boardingShown = false;
    const fired = new Set();

    function setNumber(id, value){
      const el = document.getElementById(id);
      if(!el) return;
      el.animate([{transform:'translateY(2px) scale(0.98)', opacity:0.75},{transform:'translateY(0) scale(1)', opacity:1}],{duration:180, easing:'ease-out'});
      el.textContent = value;
    }

    function fireMilestone(key, message, conf=0){
      if(fired.has(key)) return;
      fired.add(key);
      toast(message);
      if(conf) burstConfetti(conf);
      document.getElementById('hero').animate([{transform:'scale(1)'},{transform:'scale(1.01)'},{transform:'scale(1)'}],{duration:520, easing:'ease-out'});
    }

    function updateCountdown(){
      const now = Date.now();
      const diff = targetDate - now;

      if(diff <= 0){
        setNumber('days', 0); setNumber('hours', 0); setNumber('minutes', 0); setNumber('seconds', 0);
        if(!boardingShown){
          boardingShown = true;
          overlay.hidden = false;
          overlay.animate([{opacity:0},{opacity:1}],{duration:220, easing:'ease-out'});
          burstConfetti(300);
          toast('âœˆï¸ Boarding now!');
        }
        return;
      }

      const days = Math.floor(diff / (1000*60*60*24));
      if(days <= 30) fireMilestone('d30', 'â³ 30 Tage! Faro kommt nÃ¤her ğŸ‡µğŸ‡¹', 120);
      if(days <= 7)  fireMilestone('d7',  'ğŸ”¥ 7 Tage! Koffer raus & Vibes an', 180);
      if(days <= 1)  fireMilestone('d1',  'âœˆï¸ Morgen ist Abflug. Boarding soon!', 220);

      const hours = Math.floor((diff / (1000*60*60)) % 24);
      const minutes = Math.floor((diff / (1000*60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      setNumber('days', days);
      setNumber('hours', hours);
      setNumber('minutes', minutes);
      setNumber('seconds', seconds);
    }

    // ============ Theme (Day / Sunset / Night) ============
    const root = document.documentElement;
    const themeBtn = document.getElementById('themeBtn');

    function setTheme(mode){
      root.classList.toggle('night', mode === 'night');
      root.classList.toggle('sunset', mode === 'sunset');
      root.dataset.theme = mode;
      themeBtn.textContent = mode === 'day' ? 'ğŸŒ¤ï¸ Day' : (mode === 'sunset' ? 'ğŸŒ… Sunset' : 'ğŸŒ™ Night');
    }
    function autoTheme(){
      const h = new Date().getHours();
      if(h >= 20 || h <= 6) return 'night';
      if(h >= 17 && h <= 19) return 'sunset';
      return 'day';
    }
    setTheme(autoTheme());
    themeBtn.addEventListener('click', () => {
      const cur = root.dataset.theme || 'day';
      const next = cur === 'day' ? 'sunset' : (cur === 'sunset' ? 'night' : 'day');
      setTheme(next);
      toast(`Theme: ${next.toUpperCase()}`);
    });

    // ============ Music reveal ============
    const musicCard = document.getElementById('musicCard');
    document.getElementById('vibesBtn').addEventListener('click', () => {
      musicCard.hidden = false;
      musicCard.scrollIntoView({behavior:'smooth', block:'center'});
      burstConfetti(120);
    });

    // ============ Lightbox ============
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    document.getElementById('gallery').addEventListener('click', (e) => {
      const img = e.target.closest('img');
      if(!img) return;
      lbImg.src = img.dataset.full || img.src;
      lb.classList.add('open');
      lb.setAttribute('aria-hidden','false');
    });
    function closeLightbox(){
      lb.classList.remove('open');
      lb.setAttribute('aria-hidden','true');
      lbImg.src = '';
    }
    document.getElementById('lbClose').addEventListener('click', closeLightbox);
    lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLightbox(); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeLightbox(); });

    // ============ Overlay ============
    const overlay = document.getElementById('overlay');
    overlay.hidden = true;
    overlay.addEventListener('click', (e)=>{ if(e.target === overlay) overlay.hidden = true; });
    document.getElementById('overlayParty').addEventListener('click', ()=> burstConfetti(320));

    // ============ Confetti (mini) ============
    const confCanvas = document.getElementById('confetti');
    const confCtx = confCanvas.getContext('2d');
    let CW = confCanvas.width = window.innerWidth;
    let CH = confCanvas.height = window.innerHeight;
    window.addEventListener('resize', () => {
      CW = confCanvas.width = window.innerWidth;
      CH = confCanvas.height = window.innerHeight;
    });
    const confetti = [];
    function addConfetti(n=140){
      for(let i=0;i<n;i++){
        confetti.push({
          x: Math.random()*CW,
          y: -20 - Math.random()*CH*0.2,
          r: 3 + Math.random()*5,
          vx: -1.6 + Math.random()*3.2,
          vy: 2 + Math.random()*4,
          rot: Math.random()*Math.PI,
          vr: (-0.22 + Math.random()*0.44),
          life: 160 + Math.random()*160,
          hue: Math.random()*360,
        });
      }
    }
    function burstConfetti(n=220){ addConfetti(n); if(!confAnimating) confAnimate(); }
    let confAnimating = false;
    function confAnimate(){
      confAnimating = true;
      confCtx.clearRect(0,0,CW,CH);
      for(let i=confetti.length-1;i>=0;i--){
        const p = confetti[i];
        p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life -= 1;
        p.vy += 0.02; p.vx *= 0.995;
        confCtx.save();
        confCtx.translate(p.x,p.y);
        confCtx.rotate(p.rot);
        confCtx.globalAlpha = Math.max(0, Math.min(1, p.life/240));
        confCtx.fillStyle = `hsl(${p.hue}, 82%, 60%)`;
        confCtx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
        confCtx.restore();
        if(p.y > CH + 60 || p.life <= 0) confetti.splice(i,1);
      }
      if(confetti.length > 0){ requestAnimationFrame(confAnimate); }
      else { confAnimating = false; confCtx.clearRect(0,0,CW,CH); }
    }

    document.getElementById('partyBtn').addEventListener('click', () => burstConfetti(280));

    // Easter egg: title 5 taps
    let taps = 0;
    document.getElementById('title').addEventListener('click', () => {
      taps++;
      if(taps >= 5){
        taps = 0;
        burstConfetti(240);
        toast('ğŸ» Gringos Mode');
      }
    });

    // ============ ENDLEVEL FLIGHT: Berlin -> Faro ============
    const BERLIN = { name:'Berlin', lat: 52.52, lon: 13.405 };
    const FARO   = { name:'Faro',   lat: 37.0194, lon: -7.9304 };

    // Europe-ish bounds for projection
    const BOUNDS = { latMin: 34, latMax: 60, lonMin: -15, lonMax: 30 };

    function project({lat, lon}, W, H, pad=40){
      const x = (lon - BOUNDS.lonMin) / (BOUNDS.lonMax - BOUNDS.lonMin);
      const y = (BOUNDS.latMax - lat) / (BOUNDS.latMax - BOUNDS.latMin);
      return { x: pad + x*(W-2*pad), y: pad + y*(H-2*pad) };
    }

    function haversineKm(a,b){
      const R=6371; const toRad=d=>d*Math.PI/180;
      const dLat=toRad(b.lat-a.lat), dLon=toRad(b.lon-a.lon);
      const lat1=toRad(a.lat), lat2=toRad(b.lat);
      const s = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.min(1, Math.sqrt(s)));
    }

    // Great-circle points (slerp)
    function greatCirclePoints(a,b,n=140){
      const toRad=d=>d*Math.PI/180, toDeg=r=>r*180/Math.PI;
      const vec=(p)=>{
        const lat=toRad(p.lat), lon=toRad(p.lon);
        return [Math.cos(lat)*Math.cos(lon), Math.cos(lat)*Math.sin(lon), Math.sin(lat)];
      };
      const dot=(u,v)=>u[0]*v[0]+u[1]*v[1]+u[2]*v[2];
      const norm=(u)=>{ const m=Math.hypot(u[0],u[1],u[2]); return [u[0]/m,u[1]/m,u[2]/m]; };
      const slerp=(u,v,t)=>{
        const omega = Math.acos(clamp(dot(u,v), -1, 1));
        if(omega < 1e-6) return u;
        const so = Math.sin(omega);
        const a = Math.sin((1-t)*omega)/so;
        const b = Math.sin(t*omega)/so;
        return [a*u[0]+b*v[0], a*u[1]+b*v[1], a*u[2]+b*v[2]];
      };
      const toLatLon=(u)=>{
        u = norm(u);
        const lat = Math.asin(u[2]);
        const lon = Math.atan2(u[1],u[0]);
        return { lat: toDeg(lat), lon: toDeg(lon) };
      };

      const U=vec(a), V=vec(b);
      const pts=[];
      for(let i=0;i<=n;i++) pts.push(toLatLon(slerp(U,V,i/n)));
      return pts;
    }

    // Map canvas draw
    const mapCanvas = document.getElementById('mapCanvas');
    const mctx = mapCanvas.getContext('2d');

    const hudStatus = document.getElementById('hudStatus');
    const hudBar = document.getElementById('hudBar');
    const hudETA = document.getElementById('hudETA');
    const flightInfo = document.getElementById('flightInfo');

    const gc = greatCirclePoints(BERLIN, FARO, 180);
    const km = Math.round(haversineKm(BERLIN, FARO));
    const cruiseKmh = 820; // estimate
    const hoursEst = km / cruiseKmh;
    const hh = Math.floor(hoursEst);
    const mm = Math.round((hoursEst - hh) * 60);
    flightInfo.textContent = `~${km} km Â· ~${hh}h ${mm}m (simuliert)`;

    function drawMapBase(){
      const W = mapCanvas.width, H = mapCanvas.height;

      // ocean gradient
      const g = mctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0, 'rgba(0,160,255,0.22)');
      g.addColorStop(1, 'rgba(0,220,180,0.08)');
      mctx.fillStyle = g;
      mctx.fillRect(0,0,W,H);

      // subtle vignetting
      const v = mctx.createRadialGradient(W*0.5, H*0.45, H*0.2, W*0.5, H*0.45, H*0.72);
      v.addColorStop(0,'rgba(255,255,255,0.04)');
      v.addColorStop(1,'rgba(0,0,0,0.16)');
      mctx.fillStyle = v;
      mctx.fillRect(0,0,W,H);

      // stylized land blobs (simple but premium)
      function land(pathPoints, alpha){
        mctx.save();
        mctx.globalAlpha = alpha;
        mctx.fillStyle = 'rgba(255,255,255,0.18)';
        mctx.beginPath();
        mctx.moveTo(pathPoints[0].x, pathPoints[0].y);
        for(let i=1;i<pathPoints.length;i++) mctx.lineTo(pathPoints[i].x, pathPoints[i].y);
        mctx.closePath();
        mctx.fill();
        mctx.restore();
      }

      // rough shapes positioned in Europe-ish area
      land([{x:200,y:220},{x:260,y:180},{x:330,y:165},{x:410,y:180},{x:440,y:230},{x:400,y:260},{x:320,y:275},{x:245,y:270}], 0.9);
      land([{x:440,y:190},{x:500,y:160},{x:590,y:160},{x:650,y:195},{x:640,y:240},{x:570,y:255},{x:500,y:240}], 0.55);
      land([{x:650,y:220},{x:710,y:200},{x:790,y:215},{x:820,y:260},{x:770,y:300},{x:700,y:280}], 0.35);

      // faint grid lines
      mctx.save();
      mctx.globalAlpha = 0.12;
      mctx.strokeStyle = 'rgba(255,255,255,0.5)';
      for(let x=80;x<W;x+=140){ mctx.beginPath(); mctx.moveTo(x,0); mctx.lineTo(x,H); mctx.stroke(); }
      for(let y=70;y<H;y+=120){ mctx.beginPath(); mctx.moveTo(0,y); mctx.lineTo(W,y); mctx.stroke(); }
      mctx.restore();
    }

    function drawRoute(progress, phase='cruise'){
      const W = mapCanvas.width, H = mapCanvas.height;
      const pad = 54;

      const pts = gc.map(p => project({lat:p.lat, lon:p.lon}, W, H, pad));

      // route glow
      mctx.save();
      mctx.lineCap = 'round';
      mctx.lineJoin = 'round';
      mctx.shadowColor = 'rgba(255,255,255,0.28)';
      mctx.shadowBlur = 18;

      mctx.strokeStyle = 'rgba(255,255,255,0.18)';
      mctx.lineWidth = 10;
      mctx.beginPath();
      mctx.moveTo(pts[0].x, pts[0].y);
      for(let i=1;i<pts.length;i++) mctx.lineTo(pts[i].x, pts[i].y);
      mctx.stroke();

      // dashed route
      mctx.shadowBlur = 0;
      mctx.setLineDash([14, 12]);
      mctx.lineDashOffset = -performance.now()/30;
      mctx.strokeStyle = 'rgba(255,255,255,0.62)';
      mctx.lineWidth = 3.6;
      mctx.beginPath();
      mctx.moveTo(pts[0].x, pts[0].y);
      for(let i=1;i<pts.length;i++) mctx.lineTo(pts[i].x, pts[i].y);
      mctx.stroke();
      mctx.setLineDash([]);

      // endpoints
      const A = pts[0], B = pts[pts.length-1];
      mctx.fillStyle = 'rgba(255,255,255,0.9)';
      mctx.beginPath(); mctx.arc(A.x, A.y, 7.2, 0, Math.PI*2); mctx.fill();
      mctx.beginPath(); mctx.arc(B.x, B.y, 7.2, 0, Math.PI*2); mctx.fill();

      // labels
      mctx.font = '700 16px ui-sans-serif, system-ui';
      mctx.fillStyle = 'rgba(255,255,255,0.88)';
      mctx.fillText('Berlin', A.x + 14, A.y + 6);
      mctx.fillText('Faro', B.x + 14, B.y + 6);

      // plane position
      const idx = Math.floor(progress * (pts.length-2));
      const t = (progress * (pts.length-2)) - idx;
      const P = {
        x: pts[idx].x + (pts[idx+1].x - pts[idx].x)*t,
        y: pts[idx].y + (pts[idx+1].y - pts[idx].y)*t,
      };
      const P2 = pts[Math.min(idx+1, pts.length-1)];
      const ang = Math.atan2(P2.y - pts[idx].y, P2.x - pts[idx].x);

      // takeoff / landing scale
      const take = clamp(progress/0.12, 0, 1);
      const land = clamp((1-progress)/0.12, 0, 1);
      const scale = 0.9 + 0.45*Math.min(take, land);
      const wobble = (phase === 'turbulence') ? Math.sin(performance.now()/60)*0.06 : 0;

      // plane draw
      mctx.translate(P.x, P.y);
      mctx.rotate(ang + wobble);
      mctx.scale(scale, scale);

      // contrail
      mctx.save();
      mctx.globalAlpha = 0.38;
      mctx.strokeStyle = 'rgba(255,255,255,0.55)';
      mctx.lineWidth = 3;
      mctx.beginPath();
      mctx.moveTo(-30, 0);
      mctx.lineTo(-120, 0);
      mctx.stroke();
      mctx.restore();

      // plane body
      mctx.fillStyle = 'rgba(255,255,255,0.95)';
      mctx.beginPath();
      mctx.moveTo(-2, -6);
      mctx.lineTo(40, 0);
      mctx.lineTo(-2, 6);
      mctx.lineTo(6, 0);
      mctx.closePath();
      mctx.fill();

      mctx.restore();
    }

    // ============ Flight simulation timeline ============
    let simRunning = false;
    let simStart = 0;
    const SIM_MS = 12000;

    function easeInOut(t){
      return t < 0.5 ? 2*t*t : 1 - Math.pow(-2*t + 2, 2)/2;
    }

    function simPhase(t){
      if(t < 0.12) return 'takeoff';
      if(t > 0.86) return 'landing';
      if(t > 0.48 && t < 0.55) return 'turbulence';
      return 'cruise';
    }

    function renderMap(progress=0, phase='cruise'){
      mctx.setTransform(1,0,0,1,0,0);
      drawMapBase();
      drawRoute(progress, phase);
    }

    function startSimulation(){
      if(simRunning) return;
      simRunning = true;
      simStart = performance.now();
      hudStatus.textContent = 'ğŸ›« Takeoff';
      toast('ğŸ›« Takeoffâ€¦');
      burstConfetti(120);
      if(soundOn) audioTakeoff();
      requestAnimationFrame(stepSim);
    }

    function stepSim(now){
      const t = clamp((now - simStart) / SIM_MS, 0, 1);
      const e = easeInOut(t);
      const phase = simPhase(t);

      renderMap(e, phase);

      // HUD
      hudBar.style.width = `${Math.round(e*100)}%`;

      if(phase === 'takeoff'){
        hudStatus.textContent = 'ğŸ›« Takeoff';
        hudETA.textContent = `ETA ~${Math.max(0, Math.round((1-t)* (hoursEst*60))) } min (sim)`;
      } else if(phase === 'turbulence'){
        hudStatus.textContent = 'ğŸŒªï¸ Turbulence';
        hudETA.textContent = 'Seatbelt on';
      } else if(phase === 'landing'){
        hudStatus.textContent = 'ğŸ›¬ Landing';
        hudETA.textContent = 'Final approach';
      } else {
        hudStatus.textContent = 'âœˆï¸ Cruise';
        hudETA.textContent = `Cruise ~${km} km`;
      }

      if(t >= 1){
        simRunning = false;
        hudStatus.textContent = 'âœ… Landed in Faro';
        hudETA.textContent = 'Bem-vindo ğŸ‡µğŸ‡¹';
        toast('ğŸ›¬ Landed! Faro vibes ğŸ‡µğŸ‡¹');
        burstConfetti(220);
        if(soundOn) audioLanding();
        return;
      }

      requestAnimationFrame(stepSim);
    }

    // initial render
    renderMap(0, 'cruise');

    // ============ Sound (WebAudio) ============
    let audioCtx = null;
    let master = null;
    let soundOn = false;
    const soundBtn = document.getElementById('soundBtn');

    function initAudio(){
      if(audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      master = audioCtx.createGain();
      master.gain.value = 0.0;
      master.connect(audioCtx.destination);

      // ocean noise
      const bufferSize = 2 * audioCtx.sampleRate;
      const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = noiseBuffer.getChannelData(0);
      for(let i=0;i<bufferSize;i++) data[i] = (Math.random()*2 - 1) * 0.35;
      const noise = audioCtx.createBufferSource();
      noise.buffer = noiseBuffer;
      noise.loop = true;

      const noiseFilter = audioCtx.createBiquadFilter();
      noiseFilter.type = 'lowpass';
      noiseFilter.frequency.value = 550;

      const oceanGain = audioCtx.createGain();
      oceanGain.gain.value = 0.22;

      noise.connect(noiseFilter);
      noiseFilter.connect(oceanGain);
      oceanGain.connect(master);
      noise.start();

      // engine tone
      const osc = audioCtx.createOscillator();
      osc.type = 'sawtooth';
      osc.frequency.value = 58;

      const engineFilter = audioCtx.createBiquadFilter();
      engineFilter.type = 'lowpass';
      engineFilter.frequency.value = 220;

      const engineGain = audioCtx.createGain();
      engineGain.gain.value = 0.0;

      osc.connect(engineFilter);
      engineFilter.connect(engineGain);
      engineGain.connect(master);
      osc.start();

      // expose nodes
      initAudio.engineGain = engineGain;
      initAudio.engineFilter = engineFilter;
    }

    function setSound(on){
      initAudio();
      soundOn = on;
      soundBtn.textContent = on ? 'ğŸ”Š Sound' : 'ğŸ”‡ Sound';
      if(audioCtx.state === 'suspended') audioCtx.resume();

      const t = audioCtx.currentTime;
      master.gain.cancelScheduledValues(t);
      master.gain.setTargetAtTime(on ? 0.75 : 0.0, t, 0.12);

      // keep engine subtle when enabled
      const eg = initAudio.engineGain;
      eg.gain.cancelScheduledValues(t);
      eg.gain.setTargetAtTime(on ? 0.05 : 0.0, t, 0.18);

      toast(on ? 'Sound on ğŸŒŠ' : 'Sound off');
    }

    function audioTakeoff(){
      if(!audioCtx) return;
      const t = audioCtx.currentTime;
      initAudio.engineFilter.frequency.setTargetAtTime(420, t, 0.08);
      initAudio.engineGain.gain.setTargetAtTime(0.10, t, 0.08);
      setTimeout(()=>{
        const tt = audioCtx.currentTime;
        initAudio.engineFilter.frequency.setTargetAtTime(240, tt, 0.14);
        initAudio.engineGain.gain.setTargetAtTime(0.06, tt, 0.14);
      }, 900);
    }

    function audioLanding(){
      if(!audioCtx) return;
      const t = audioCtx.currentTime;
      initAudio.engineFilter.frequency.setTargetAtTime(180, t, 0.18);
      initAudio.engineGain.gain.setTargetAtTime(0.03, t, 0.18);
    }

    soundBtn.addEventListener('click', () => setSound(!soundOn));

    // ============ Buttons ============
    document.getElementById('simulateBtn').addEventListener('click', startSimulation);

    // boarding overlay
    document.getElementById('overlayParty').addEventListener('click', ()=> burstConfetti(320));

    // ============ Parallax-ish hero drift ============
    window.addEventListener('scroll', () => {
      const y = window.scrollY;
      document.getElementById('hero').style.transform = `translateY(${Math.min(18, y*0.04)}px)`;
    }, {passive:true});

    // ============ init loop ============
    updateCountdown();
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
